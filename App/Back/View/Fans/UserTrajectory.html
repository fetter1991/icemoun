<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
<head>
    <title>用户轨迹</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <meta name="renderer" content="webkit"/>
    <link href="__MC__/global/css/components.min.css" rel="stylesheet" id="style_components" type="text/css"/>
    <link href="__MC__/global/css/plugins.min.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/global/plugins/bootstrap-datetimepicker/css/bootstrap-datetimepicker.min.css" rel="stylesheet"
          type="text/css"/>
    <link href="__MC__/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/global/plugins/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/layouts/layout/css/layout.min.css" rel="stylesheet" type="text/css"/>
    <link href="__MC__/layouts/layout/css/custom.min.css" rel="stylesheet" type="text/css"/>
    <style>
        td {
            vertical-align: middle!important;
        }

        .col-lg-3 {
            width: 20%;
            padding: 5px;
        }

        .float-left {
            display: inline-block;
            float: left;
        }

        #onload {
            position: fixed;
            z-index: 400;
            width: 100%;
            height: 100%;
            top: 0%;
            left: 0%;
            text-align: center;
            font-size: 0.9rem;
            color: #595758;
            background-color: #fbfbfb;
            padding-top: 20%;
        }
    </style>
</head>
<body>
<div id="onload">
    <img src='__IMG__/load.gif' width="8%"/>
</div>
<div class="container" style="width: 98%">
    <!--搜索条件-->
    <div class="row" style="padding: 10px 0;">
        <div class="col-md-6 col-sm-6">
            <div id="sample_1_filter" class="dataTables_filter">
                <form class="form-horizontal" role="form" action="#" method="get">
                    <div class="col-lg-3" style="width: 33%">
                        <button class="btn success date-set btn-sm float-left day" type="button" data-content="-1">
                            <i class="fa fa-arrow-left"></i>
                        </button>
                        <div class="input-group date form_datetime float-left" data-date="" id="startTime">
                            <span class="input-group-btn float-left">
                                <button class="btn success date-set btn-sm" type="button">
                                    <i class="fa fa-calendar"></i>
                                </button>
                            </span>
                            <input size="16" type="text" name="date" id="date"
                                   value="{$date}" placeholder="选择时间" readonly
                                   style="display: inline-block; width: 81%;float: right;"
                                   class="form_datetime table-group-action-input form-control input-inline input-sm float-left">
                        </div>
                        <button class="btn success date-set btn-sm float-left day" type="button" data-content="+1">
                            <i class="fa fa-arrow-right"></i>
                        </button>
                    </div>
                    <div class="col-lg-3">
                        <select class="form-control" id="platform_id" name="platform_id">
                            <option value="0">全部平台</option>
                            <volist name="platformList" id="v">
                                <option value="{$v.id}"
                                <if condition="$platform_id == $v['id']">selected</if>
                                >{$v.name}</option>
                            </volist>
                        </select>
                    </div>
                    <div class="col-lg-3">
                        <select class="form-control" id="foo_id" name="foo_id">
                            <option value="0">全部页面</option>
                            <volist name="fooList" id="f">
                                <option value="{$f.id}"
                                <if condition="$foo_id == $f['id']">selected</if>
                                >{$f.name}</option>
                            </volist>
                        </select>
                    </div>
                    <div class="col-lg-3">
                        <input type="hidden" value="{$user_id}" id="user_id" name="user_id"/>
                        <button class="btn green" id="search">搜索</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!--数据表格-->
    <div class="row" style="margin-top: 10px;">
        <div class="col-md-12 col-sm-12">
            <table class="table table-bordered table-striped table-condensed flip-content">
                <thead>
                <tr>
                    <th class="text-center">平台</th>
                    <th class="text-center">渠道</th>
                    <th class="text-center">页面功能</th>
                    <th class="text-center">轨迹说明</th>
                    <th class="text-center">系统<br/>&IP</th>
                    <th class="text-center">时间</th>
                </tr>
                </thead>
                <tbody>
                <if condition='!empty($list)'>
                    <volist name="list" id="vo" key="k">
                        <tr>
                            <td class="text-center">{$vo.platform_name}</td>
                            <td class="text-center">{$vo.channel_name}</td>
                            <td class="text-center">{$vo.foo_name}</td>
                            <td class="text-left" style="padding-left: 15px;">
                                {$vo.expand.output}
                            </td>
                            <td class="text-center">{$vo.os}<br/>{$vo.ip}</td>
                            <td class="text-center">{$vo.created_at}</td>
                        </tr>
                    </volist>
                    <else/>
                    <tr>
                        <td class="text-center" colspan="7">暂无数据</td>
                    </tr>
                </if>
                </tbody>
            </table>
            {$pages}
        </div>
    </div>
</div>
</body>
<script src="__MC__/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="__JS__/layer/2.4/layer.js"></script>
<script src="__MC__/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="__MC__/global/plugins/bootstrap-datetimepicker/js/bootstrap-datetimepicker.min.js"
        type="text/javascript"></script>
<script src="__MC__/global/plugins/bootstrap-datetimepicker/js/locales/bootstrap-datetimepicker.zh-CN.js"
        type="text/javascript"></script>
<script src="__MC__/global/plugins/bootstrap-select/js/bootstrap-select.js" type="text/javascript"></script>
<script src="__MC__/global/plugins/bootstrap-select/js/i18n/defaults-zh_CN.min.js" type="text/javascript"></script>
<script>
    $('#onload').show();
    //时间插件
    $('#startTime').datetimepicker({
        minView: "month",
        language: 'zh-CN',
        format: 'yyyy-mm-dd',
        autoclose: true,
        todayBtn: true
    });
    //
    $('#platform_id,#foo_id').on('change', function () {
        var date = $("#startTime").find("input").val();
        search(date);
    });

    //搜索
    $('#search').on('click', function () {
        var date = $("#startTime").find("input").val();
        search(date);
    });
    //选择日期
    $('.day').on('click', function () {
        var inputDate = $("#startTime").find("input").val();
        var type = $(this).data('content');
        var now = (new Date(inputDate)).getTime();

        var date = now + (type * 86400000);
        date = new Date(date).Format("yyyy-MM-dd");
        search(date)
    });
    //时间处理
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "H+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };

    //搜索方法
    function search(date) {
        var user_id = $("#user_id").val();
        var platform_id = $('#platform_id').val();
        var foo_id = $('#foo_id').val();
        window.location.href = "/Back/Fans/UserTrajectory?user_id=" + user_id + "&date=" + date + "&platform_id=" + platform_id + "&foo_id=" + foo_id;
    }

    //页面加载完成
    $(window).load(function () {
        $('#onload').hide();
    });
</script>
</html>
